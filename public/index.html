<!DOCTYPE html>
<html lang="en">
<head> 
   <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-TFGJW77C5H"></script>
  <script src="gtag.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat with LLM</title>
  <meta name="description" content="Private AI chat that runs entirely in your browser. No data leaves your device.">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Loading Screen -->
  <div id="loadingScreen" class="loading-screen">
    <div class="loading-spinner"></div>
    <div class="loading-text">Initializing...</div>
    <div class="loading-subtext">Connecting to your private AI assistant</div>
  </div>

  <!-- Overlay for sidebars -->
  <div id="overlay" class="overlay"></div>

  <!-- Chat History Sidebar -->
  <aside id="sidebar" class="sidebar">
    <div class="sidebar-header">
      <h3>Chats</h3>
      <button id="newChatBtn" class="new-chat-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
          <path d="M12 5v14M5 12h14"/>
        </svg>
        New
      </button>
    </div>
    <div id="chatList" class="chat-list">
      <!-- Chat list items populated by JS -->
    </div>
  </aside>

  <!-- Settings Panel -->
  <aside id="settingsPanel" class="settings-panel">
    <div class="settings-header">
      <h3>Settings</h3>
      <button id="closeSettingsBtn" class="icon-btn">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 6L6 18M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <div class="settings-content">
      <div class="settings-section">
        <h4>Theme</h4>
        <div class="settings-item">
          <span class="settings-label">Dark Mode</span>
          <button id="themeToggle" class="settings-btn">Toggle</button>
        </div>
      </div>
      <div class="settings-section">
        <h4>Data</h4>
        <div class="settings-item">
          <span class="settings-label">Export Chat History</span>
          <button id="exportBtn" class="settings-btn">Export</button>
        </div>
        <div class="settings-item">
          <span class="settings-label">Clear Current Chat</span>
          <button id="clearChatBtn" class="settings-btn danger">Clear</button>
        </div>
        <div class="settings-item">
          <span class="settings-label">Delete All Data</span>
          <button id="deleteAllBtn" class="settings-btn danger">Delete All</button>
        </div>
      </div>
      <div class="settings-section">
        <h4>Cached Models</h4>
        <div id="cachedModelsContainer" class="cached-models-container">
          <div class="cached-models-loading">Loading...</div>
        </div>
        <div class="settings-item">
          <span class="settings-label">Clear All Cached Models</span>
          <button id="clearAllModelsBtn" class="settings-btn danger">Clear All</button>
        </div>
      </div>
      <div class="settings-section">
        <h4>About</h4>
        <div class="settings-item">
          <span class="settings-label">User ID</span>
          <span id="userIdDisplay" class="settings-label" style="font-size: 11px; color: var(--text-muted);">Loading...</span>
        </div>
        <div class="settings-item">
          <span class="settings-label">Version</span>
          <span class="settings-label" style="color: var(--text-muted);">1.0.0</span>
        </div>
      </div>
    </div>
  </aside>

  <!-- Main App Container -->
  <div class="app-container">
    <!-- Header -->
    <header class="header">
      <div class="header-title">
        <button id="menuBtn" class="icon-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 12h18M3 6h18M3 18h18"/>
          </svg>
        </button>
        <h1>Chat with LLM</h1>
      </div>
      <div class="header-controls">
        <div class="model-selector">
          <select id="modelSelect">
            <option value="Qwen3-0.6B-q4f16_1-MLC">Qwen3 0.6B (Fast)</option>
            <option value="Llama-3.2-1B-Instruct-q4f16_1-MLC">Llama 3.2 1B</option>
            <option value="SmolLM2-1.7B-Instruct-q4f16_1-MLC">SmolLM2 1.7B</option>
            <option value="gemma-2-2b-it-q4f16_1-MLC">Gemma 2 2B</option>
            <option value="Llama-3.2-3B-Instruct-q4f16_1-MLC">Llama 3.2 3B</option>
            <option value="Phi-3.5-mini-instruct-q4f16_1-MLC">Phi-3.5 Mini (Best)</option>
          </select>
        </div>
        <button id="settingsBtn" class="icon-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/>
          </svg>
        </button>
      </div>
    </header>

    <!-- Status Bar -->
    <div class="status-bar">
      <div class="status-item">
        <span id="statusDot" class="status-dot"></span>
        <span id="statusText">Initializing...</span>
      </div>
      <div id="progressContainer" class="progress-bar" style="display: none;">
        <div id="progressFill" class="progress-bar-fill" style="width: 0%"></div>
      </div>
      <div class="connection-status" id="connectionStatus">
        <span class="status-dot ready"></span>
        <span>Synced</span>
      </div>
    </div>

    <!-- Chat Container -->
    <main id="chatContainer" class="chat-container">
      <!-- Welcome message shown when no messages -->
      <div id="welcomeMessage" class="welcome-message">
        <h2>Welcome to Private AI Chat</h2>
        <p>Your conversations run entirely in your browser. No data is sent to external servers.</p>
        <div class="welcome-features">
          <div class="feature">
            <div class="feature-icon">ðŸ¤–</div>
            <span>Browser AI</span>
          </div>
          <div class="feature">
            <div class="feature-icon">âš¡</div>
            <span>Fast Local AI</span>
          </div>
          <div class="feature">
            <div class="feature-icon">ðŸ’¾</div>
            <span>Cloud Sync</span>
          </div>
        </div>
      </div>
    </main>

    <!-- Input Area -->
    <div class="input-container">
      <div class="input-wrapper">
        <div class="input-field">
          <textarea
            id="messageInput"
            placeholder="Type your message..."
            rows="1"
            disabled
          ></textarea>
        </div>
        <button id="sendBtn" class="send-btn" disabled>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
          </svg>
        </button>
      </div>
      <div class="token-counter">
        <span id="tokenCount">Tokens: 0 / 4096</span>
        <span id="contextStatus"></span>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <!--
    SECURITY NOTE: Subresource Integrity (SRI)
    SRI is not practical for ES modules loaded dynamically from CDNs like esm.run.
    Security is provided by: CSP headers, HTTPS, and trusted CDN providers (gstatic.com).
    For maximum security, consider bundling dependencies locally.
  -->
  <script type="module" src="firebase-config.js"></script>
  <script type="module" src="db.js"></script>
  <script type="module" src="memory.js"></script>
  <script type="module" src="app.js"></script>
</body>
</html>
